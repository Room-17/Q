<!DOCTYPE html>
<html>
<head>
  <title>Class Queue</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, button { margin: 5px; padding: 8px; font-size: 1em; }
    button { cursor: pointer; }
    li { margin-bottom: 10px; }
    .note { font-size: 0.9em; color: gray; }
    .timestamp { font-size: 0.8em; color: #666; margin-top: 4px; }
    .remove-btn { margin-left: 10px; font-size: 0.8em; }
  </style>
</head>
<body>
  <h1>üìö Class Queue</h1>

  <input id="name" placeholder="Your name" />
  <input id="note" placeholder="Private note to teacher (optional)" />
  <button onclick="addToQueue()">Join Queue</button>

  <h2>üìù Queue</h2>
  <ol id="queueList"></ol>

  <script>
    const teacherMode = new URLSearchParams(window.location.search).get("teacher") === "true";

    function formatTime(isoString) {
      const date = new Date(isoString);
      return date.toLocaleString();
    }

    function renderQueue() {
      const queue = JSON.parse(localStorage.getItem("queue") || "[]");
      queue.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));

      const list = document.getElementById("queueList");
      list.innerHTML = "";

      queue.forEach((entry, i) => {
        const li = document.createElement("li");
        li.textContent = entry.name;

        const time = document.createElement("div");
        time.textContent = "üïí Joined: " + formatTime(entry.timestamp);
        time.className = "timestamp";
        li.appendChild(time);

        if (teacherMode && entry.note) {
          const note = document.createElement("div");
          note.textContent = "üîí Note: " + entry.note;
          note.className = "note";
          li.appendChild(note);
        }

        if (teacherMode) {
          const removeBtn = document.createElement("button");
          removeBtn.textContent = "‚ùå Remove";
          removeBtn.className = "remove-btn";
          removeBtn.onclick = () => {
            const updatedQueue = JSON.parse(localStorage.getItem("queue") || "[]");
            updatedQueue.splice(i, 1);
            localStorage.setItem("queue", JSON.stringify(updatedQueue));
            renderQueue();
          };
          li.appendChild(removeBtn);
        }

        list.appendChild(li);
      });

      if (teacherMode && queue.length > 0 && !document.getElementById("clearBtn")) {
        const clearBtn = document.createElement("button");
        clearBtn.textContent = "üßº Clear Entire Queue";
        clearBtn.id = "clearBtn";
        clearBtn.onclick = () => {
          if (confirm("Clear the entire queue?")) {
            localStorage.removeItem("queue");
            renderQueue();
          }
        };
        document.body.appendChild(clearBtn);
      }
    }

    function addToQueue() {
      const name = document.getElementById("name").value.trim();
      const note = document.getElementById("note").value.trim();
      if (!name) return alert("Please enter your name.");

      const queue = JSON.parse(localStorage.getItem("queue") || "[]");
      queue.push({ name, note, timestamp: new Date().toISOString() });
      localStorage.setItem("queue", JSON.stringify(queue));

      document.getElementById("name").value = "";
      document.getElementById("note").value = "";
      renderQueue();
    }

    renderQueue();
  </script>
</body>
</html>
